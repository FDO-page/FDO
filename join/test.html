<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDO 答题</title>
    <style>
        /* (样式与之前相同，保持不变) */
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
            line-height: 1.6;
        }

        /* 容器 */
        .container {
            display: flex;
            height: 100vh;
        }

        /* 左侧内容区 */
        .content-area {
            width: 66.66%;
            overflow-y: auto;
            padding: 20px;
            border-right: 1px solid #ccc;
        }

        /* 右侧题目区 */
        .quiz-area {
            width: 33.33%;
            overflow-y: auto;
            padding: 20px;
        }

        /* 题目样式 */
        .question {
            margin-bottom: 20px;
        }

        .question h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .options label {
            display: block;
            margin-bottom: 5px;
            cursor: pointer;
        }

        /* 按钮样式 */
        .button {
            background-color: #000;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        .button:disabled {
            background-color: #999;
            cursor: not-allowed;
        }

        /* 提交按钮样式 */
        #submit-button {
          margin-top: auto; /* 将提交按钮推到底部 */
          align-self: flex-end; /* 自身对齐到底部 */

        }


        /* 移动端样式 */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }

            .content-area {
                width: 100%;
                height: 66.66vh;
                border-right: none;
                border-bottom: 1px solid #ccc;
                padding-bottom: 0;
            }

            .quiz-area {
                width: 100%;
                height: 33.33vh; /* 固定高度 */
                overflow-y: visible;
                position: relative;
            }
          .quiz-area.completed {
                height: auto;
                overflow-y: auto;
            }

            .question {
                margin-bottom: 10px; /* 减少题目间距 */
            }

            .buttons-container {
                position: absolute;
                bottom: 10px;
                left: 0; /* 修复水平居中 */
                width: 100%;
                display: flex;
                justify-content: center;
            }
            #submit-button{
              display:none;
            }
        }
      /* 暗色模式 */
        @media (prefers-color-scheme: dark) {
          body {
            background-color: #121212;
            color: #ddd;
          }

          .content-area, .quiz-area {
            border-color: #444;
          }

          .button {
            background-color: #fff;
            color: #000;
          }

          .button:disabled {
            background-color: #666;
          }
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧内容区域 -->
        <div class="content-area" id="content-area">
            <!-- 文件三内容 -->
            <div id="file3-content"></div>
        </div>

        <!-- 右侧题目区域 -->
        <div class="quiz-area" id="quiz-area">
            <!-- 题目 -->
            <div id="questions-container"></div>
            <div class="buttons-container">
            <!-- 按钮 -->
            <button id="prev-button" class="button" disabled>上一题</button>
            <button id="next-button" class="button" >下一题</button>
            </div>
            <!-- 提交按钮 -->
            <button id="submit-button" class="button" style="display: none;">提交</button>

        </div>
    </div>

    <script>
        // (除了 checkAnswersAndProceed 函数，其余 JS 代码与之前相同)
        const file3Content = `
            FDO交流群内部发言原则（群规试行稿）

            本群群成员，即FDO成员，在本群的发言需遵守本发言原则。

            本群不是八卦群：本群不是用于八卦，不是各种未被可信来源证实的信息汇聚的地方。任何在本群提出的事实性内容需要可信来源，任何人都可以/应该对他人提出的信息请求可信来源。提出信息者负举出可信来源的责任。可信来源根据#T事实核查原则判断。

            本群不是饭桌酒席：本群是允许/尊重/鼓励不同观点的群聊，而不只是同温层的交流群。本群内发言不能在没有符合逻辑的论证情况对任何观点下出结论。提出结论者负论证的责任。在本群对待不同观点内要包容、善意推定，对自己已认识到的的错误要及时承认。

            本群不是政治游乐场：本群不是用于发泄情绪的群聊。本群讨论内容或该与当前话题有关，或该新起话题，而不应该有离题内容。本群禁止无关表情包/图片/视频。本群内发言不能包含无必要的侮辱性质词语。

            本群不是新闻媒体：本群提供的不是时时新闻，本群主要目的为互相交流观点，但也不拒绝带有观点评价的新闻。


            FDOrganization事实查证方针（试行稿）
            简而言之：事实需要可信引证，谁提出谁查证

            个人观点：在表达个人观点时，不需要引证。
            引述观点：在引述其他人的观点时，需要可靠引证。可靠引证分为两种情况，对于群内人员应直接使用引用功能引用元内容。对于群外人员，需要可信的来源，比如个人认证的社交媒体账号，可信媒体报道。如果来源不可信或没有给出来源成员可以向引述观点的人请求来源。
            引述事实：在引述事实时最好选择维基百科，或者其他的可信媒体报道。如果来源不可信或没有给出来源成员可以向引述观点的人请求来源。

            引用本方针简称 #T方针 或 #T
        `;

        // 题目数据
        const questions = [
            {
                text: "根据FDO群规，以下哪种行为是不被允许的？",
                options: [
                    "A. 分享经过Fact Check的新闻报道",
                    "B. 对其他成员的观点提出质疑，并要求提供可信来源",
                    "C. 在群里发布大量未经证实的八卦消息",
                    "D. 理性讨论，即使观点不同也互相尊重"
                ],
                correctAnswer: "C",
                file: "file3-content"
            },
            {
                text: "FDO群内讨论时，对待不同观点的正确态度是什么？",
                options: [
                    "A. 直接否定，不予理睬",
                    "B. 包容、善意推定，并进行理性讨论",
                    "C. 只能接受与自己相同的观点",
                    "D. 随意嘲讽、攻击不同观点"
                ],
                correctAnswer: "B",
                file: "file3-content"
            },
            {
                text: "关于在FDO群内提出事实性内容，以下说法正确的是？",
                options: [
                    "A. 不需要提供任何来源，因为是个人观点",
                    "B. 提出者有责任提供可信来源",
                    "C. 只要是自己相信的，就不需要来源",
                    "D. 来源是否可信不重要"
                ],
                correctAnswer: "B",
                file: "file3-content"
            },
            {
                text: "以下哪种情况不需要提供引证？",
                options: [
                    "A. 引述其他群成员的观点",
                    "B. 引述新闻报道",
                    "C. 表达个人观点",
                    "D. 引述维基百科内容"
                ],
                correctAnswer: "C",
                file: "file3-content"

            },
            {
                text: "如果在群里看到有人发布了你认为不可靠的信息，你应该怎么做？",
                 options: [
                    "A. 直接举报给管理员",
                    "B. 私下联系发布者，要求删除",
                    "C. 在群里公开质疑，并要求对方提供可信来源",
                    "D. 不予理睬，或者嘲讽对方"
                ],
                correctAnswer: "C",
                file: "file3-content"
            }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let hasAnswered = false; // 标记当前题目是否已作答

        const contentArea = document.getElementById('content-area');
        const file3ContentDiv = document.getElementById('file3-content');
        const questionsContainer = document.getElementById('questions-container');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const submitButton = document.getElementById('submit-button');
        const quizArea = document.getElementById('quiz-area');

        // 初始加载文件三内容
        file3ContentDiv.innerHTML = file3Content;

        // 显示题目
        function displayQuestion(index) {
            const question = questions[index];
            let questionHTML = `
                <div class="question" id="question-${index}">
                    <h3>${index + 1}. ${question.text}</h3>
                    <div class="options">
            `;

            question.options.forEach(option => {
                questionHTML += `
                    <label>
                        <input type="radio" name="question-${index}" value="${option[0]}" ${userAnswers[index] === option[0] ? 'checked' : ''}>
                        ${option}
                    </label>
                `;
            });

            questionHTML += `</div></div>`;
            questionsContainer.innerHTML = questionHTML;

            // 禁用/启用 上一题 按钮
            prevButton.disabled = index === 0;

            // 检查是否已回答
            hasAnswered = !!userAnswers[index];
              // 根据是否已回答设置“下一题”按钮状态, 如果是最后一题，隐藏“下一题”按钮，显示“提交”按钮
            if (index === questions.length - 1) {
                nextButton.style.display = 'none';
                submitButton.style.display = 'inline-block';
                submitButton.disabled = !hasAnswered;
            } else {
                nextButton.style.display = 'inline-block';
                submitButton.style.display = 'none';
                nextButton.disabled = !hasAnswered;
            }

            // 滚动到题目顶部 (移动端)
            if (window.innerWidth <= 768) {
              quizArea.scrollTop = 0;
            }

            // 更新内容区域
            const fileContentDiv = document.getElementById(question.file);
             if (fileContentDiv) {
                // 如果内容已存在，则滚动到该内容
                fileContentDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }


        // 检查答案并跳转 *修改的部分*
        function checkAnswersAndProceed() {
            let correctCount = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correctAnswer) {
                    correctCount++;
                }
            }

            if (correctCount >= questions.length - 1) {
                // 过关，设置 Cookie 并跳转
                document.cookie = "fdo_quiz_passed=true; path=/; max-age=" + (60 * 60 * 24 * 7); // 7天有效期
                window.location.href = "/join";

            } else {
                // 未过关，重置
                alert(`很遗憾，您没有通过测试。答对 ${correctCount} 题，需要答对 ${questions.length - 1} 题及以上才能通过。请重新作答。`);
                resetQuiz();
            }
        }


        // 重置测验
        function resetQuiz() {
            currentQuestionIndex = 0;
            userAnswers = [];
            hasAnswered = false;
            displayQuestion(currentQuestionIndex);
            file3ContentDiv.innerHTML = file3Content;  // 重新加载文件三
        }

        // 上一题
        prevButton.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex);
            }
        });

        // 下一题/提交
         nextButton.addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1 && hasAnswered) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
            }
        });

        // 提交
        submitButton.addEventListener('click', () => {
            if(hasAnswered) {
                checkAnswersAndProceed();
            }
        });

        // 监听选项变化
        questionsContainer.addEventListener('change', (event) => {
          if (event.target.type === 'radio') {
            const selectedAnswer = event.target.value;
            userAnswers[currentQuestionIndex] = selectedAnswer;  // 更新答案
            hasAnswered = true; // 标记为已回答
            nextButton.disabled = false; // 启用“下一题”
            if (currentQuestionIndex === questions.length - 1) {
              submitButton.disabled = false;
            }

            // 如果不是最后一题，自动进入下一题（仅PC端）
            if (window.innerWidth > 768 && currentQuestionIndex < questions.length - 1) {
              currentQuestionIndex++;
              displayQuestion(currentQuestionIndex);
            }
          }

        });

        // 初始加载第一题
        displayQuestion(currentQuestionIndex);
    </script>
</body>
</html>
