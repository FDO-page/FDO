<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDO 入群测试</title>
    <style>
        /* ----- 全局样式 ----- */
        body {
            font-family: 'Helvetica Neue', 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
            line-height: 1.6;
        }

        /* ----- 容器 ----- */
        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ----- 左侧内容区 (文件三) ----- */
        .content-area {
            width: 66.66%;
            overflow-y: auto;
            padding: 25px;
            background-color: #fff;
            border-right: 1px solid #ccc;
        }

        .content-area h2 {
            font-size: 1.5rem;
            color: #000;
            margin-bottom: 1rem;
            border-bottom: 2px solid #000;
            padding-bottom: 0.5rem;
            display: inline-block;
        }

        .content-area p {
            margin-bottom: 1rem;
            text-indent: 2em;
            line-height: 1.8;
            color: #555;
        }
        .content-area ul {
          padding-left: 2em;
        }

        /* ----- 右侧题目区 ----- */
        .quiz-area {
            width: 33.33%;
            padding: 25px;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative; /* 保持相对定位 */
        }
        /* 内部容器 */
        .quiz-area-inner {
            position: sticky; /* 悬浮的关键 */
            top: 50%;       /* 垂直居中 */
            transform: translateY(-50%); /* 垂直居中 */
            width: 100%;
            max-height: 80vh; /* 最大高度限制 */
            overflow-y: auto; /* 如果题目内容过多，允许滚动 */
        }
        /* ----- 题目样式 ----- */
        .question {
            margin-bottom: 25px;
              opacity: 1; /* 初始不透明 */
            transition: opacity 0.4s ease-in-out;
        }

        .question.fade-out {
          opacity: 0; /* 消失时透明度为0 */
          filter: blur(5px); /* 模糊效果 */
        }

        .question.fade-in{
          opacity: 1;
          filter: blur(0);
        }

        .question h3 {
            font-size: 1.3rem;
            margin-bottom: 12px;
            color: #000;
            font-weight: 600;
        }

        .options label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
            color: #555;
        }

        .options label:hover {
            background-color: #e9ecef;
        }

        .options input[type="radio"]:checked + span {
            font-weight: bold;
            color: #000;
        }

        /* ----- 按钮样式 ----- */
        .button {
            background-color: #000;
            color: #fff;
            padding: 12px 18px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        .button:disabled{
            background-color: #aaa;
            cursor:not-allowed;
        }
        .button:hover:enabled {
            background-color: #333;
        }

        /* 提交按钮样式 */
        #submit-button {
            margin-top: 20px;
            align-self: center;
        }

        /* ----- 移动端样式 ----- */
         @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .content-area {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #ccc;
                padding: 20px;
                height: auto;
                min-height: 60vh; /* 调整最小高度 */
                box-sizing: border-box;

            }

            .quiz-area {
                width: 100%;
                padding: 20px;
                position: fixed; /* 固定定位 */
                bottom: 0;       /* 底部对齐 */
                left: 0;        /* 左侧对齐 */
                max-height: 40vh;  /* 最大高度 */
                overflow-y: auto;  /* 如果题目内容过多，允许滚动 */
                justify-content: flex-start; /* 顶部对齐 */
                background-color: #f8f9fa;

            }
              .quiz-area-inner {
                position: static; /* 取消固定定位 */
                transform: none;  /* 取消变换 */
                max-height: none;
                overflow-y: visible;
                width: 100%;
            }
            .buttons-container{
              display:flex;
              justify-content: space-around;
              width: 100%;
            }

            .question {
                margin-bottom: 15px;
            }
            #submit-button{
              display:none;
            }
        }


        /* ----- 暗色模式 (可选) ----- */
       @media (prefers-color-scheme: dark) {
            body {
                background-color: #121212;
                color: #ddd;
            }

            .content-area {
                background-color: #1e1e1e;
                border-color: #444;
            }

            .content-area h2 {
                color: #fff;
                border-color: #fff;
            }
            .content-area p{
                color:#aaa;
            }

            .quiz-area {
                background-color: #121212; /* 与 body 相同的背景色 */
            }

            .options label {
                color: #aaa;
            }

            .options label:hover {
                background-color: #333;
            }

            .options input[type="radio"]:checked + span {
                color: #fff;
            }

            .button {
                background-color: #fff;
                color: #000;
            }
            .button:disabled{
              background-color:#666
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧内容区域 (文件三) -->
        <div class="content-area" id="content-area">
            <!-- 文件三内容 -->
            <div id="file3-content"></div>
        </div>

        <!-- 右侧题目区域 -->
        <div class="quiz-area" id="quiz-area">
            <div class="quiz-area-inner">
              <!-- 题目 -->
              <div id="questions-container"></div>

              <div class="buttons-container">
              <!-- 按钮 -->
              <button id="prev-button" class="button" disabled>上一题</button>
              <button id="next-button" class="button" >下一题</button>
              </div>
              <!-- 提交按钮 -->
              <button id="submit-button" class="button" style="display: none;">提交</button>
            </div>
        </div>
    </div>

    <script>
        // (JS 代码有改动，需要复制)
        // 文件三的内容 (格式化)
        const file3Content = `
            <h2>FDO交流群内部发言原则（群规试行稿）</h2>
            <p>本群群成员，即FDO成员，在本群的发言需遵守本发言原则。</p>

            <p><b>本群不是八卦群：</b>本群不是用于八卦，不是各种未被可信来源证实的信息汇聚的地方。任何在本群提出的事实性内容需要可信来源，任何人都可以/应该对他人提出的信息请求可信来源。提出信息者负举出可信来源的责任。可信来源根据#T事实核查原则判断。</p>

            <p><b>本群不是饭桌酒席：</b>本群是允许/尊重/鼓励不同观点的群聊，而不只是同温层的交流群。本群内发言不能在没有符合逻辑的论证情况对任何观点下出结论。提出结论者负论证的责任。在本群对待不同观点内要包容、善意推定，对自己已认识到的的错误要及时承认。</p>

            <p><b>本群不是政治游乐场：</b>本群不是用于发泄情绪的群聊。本群讨论内容或该与当前话题有关，或该新起话题，而不应该有离题内容。本群禁止无关表情包/图片/视频。本群内发言不能包含无必要的侮辱性质词语。</p>

            <p><b>本群不是新闻媒体：</b>本群提供的不是时时新闻，本群主要目的为互相交流观点，但也不拒绝带有观点评价的新闻。</p>


            <h2>FDOrganization事实查证方针（试行稿）</h2>
            <p>简而言之：事实需要可信引证，谁提出谁查证</p>
            <ul>
            <li><b>个人观点：</b>在表达个人观点时，不需要引证。</li>
            <li><b>引述观点：</b>在引述其他人的观点时，需要可靠引证。可靠引证分为两种情况，对于群内人员应直接使用引用功能引用元内容。对于群外人员，需要可信的来源，比如个人认证的社交媒体账号，可信媒体报道。如果来源不可信或没有给出来源成员可以向引述观点的人请求来源。</li>
            <li><b>引述事实：</b>在引述事实时最好选择维基百科，或者其他的可信媒体报道。如果来源不可信或没有给出来源成员可以向引述观点的人请求来源。</li>
            </ul>
            <p>引用本方针简称 #T方针 或 #T</p>
        `;

        // 题目数据
 const questions = [
            {
                text: "根据FDO群规，以下哪种行为是不被允许的？",
                options: [
                    "A. 分享经过Fact Check的新闻报道",
                    "B. 对其他成员的观点提出质疑，并要求提供可信来源",
                    "C. 在群里发布大量未经证实的八卦消息",
                    "D. 理性讨论，即使观点不同也互相尊重"
                ],
                correctAnswer: "C",
                file: "file3-content"
            },
            {
                text: "FDO群内讨论时，对待不同观点的正确态度是什么？",
                options: [
                    "A. 直接否定，不予理睬",
                    "B. 包容、善意推定，并进行理性讨论",
                    "C. 只能接受与自己相同的观点",
                    "D. 随意嘲讽、攻击不同观点"
                ],
                correctAnswer: "B",
                file: "file3-content"
            },
            {
                text: "关于在FDO群内提出事实性内容，以下说法正确的是？",
                options: [
                    "A. 不需要提供任何来源，因为是个人观点",
                    "B. 提出者有责任提供可信来源",
                    "C. 只要是自己相信的，就不需要来源",
                    "D. 来源是否可信不重要"
                ],
                correctAnswer: "B",
                file: "file3-content"
            },
            {
                text: "以下哪种情况不需要提供引证？",
                options: [
                    "A. 引述其他群成员的观点",
                    "B. 引述新闻报道",
                    "C. 表达个人观点",
                    "D. 引述维基百科内容"
                ],
                correctAnswer: "C",
                file: "file3-content"

            },
            {
                text: "如果在群里看到有人发布了你认为不可靠的信息，你应该怎么做？",
                 options: [
                    "A. 直接举报给管理员",
                    "B. 私下联系发布者，要求删除",
                    "C. 在群里公开质疑，并要求对方提供可信来源",
                    "D. 不予理睬，或者嘲讽对方"
                ],
                correctAnswer: "C",
                file: "file3-content"
            }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let hasAnswered = false;

        const contentArea = document.getElementById('content-area');
        const file3ContentDiv = document.getElementById('file3-content');
        const questionsContainer = document.getElementById('questions-container');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const submitButton = document.getElementById('submit-button');
        const quizArea = document.getElementById('quiz-area');

        file3ContentDiv.innerHTML = file3Content;

        // 显示题目 (修改)
        function displayQuestion(index, animate = false) {
          const question = questions[index];
          let questionHTML = `
              <div class="question" id="question-${index}">
                  <h3>${index + 1}. ${question.text}</h3>
                  <div class="options">
          `;

          question.options.forEach(option => {
              questionHTML += `
                  <label>
                      <input type="radio" name="question-${index}" value="${option[0]}" ${userAnswers[index] === option[0] ? 'checked' : ''}>
                      <span>${option}</span>
                  </label>
              `;
          });

          questionHTML += `</div></div>`;

          if (animate) {
            // 先让当前题目淡出
            const currentQuestionElem = document.querySelector('.question');
            if (currentQuestionElem) {
                currentQuestionElem.classList.add('fade-out');
            }

            // 延迟一段时间，等待淡出动画完成后再显示新题目
            setTimeout(() => {
              questionsContainer.innerHTML = questionHTML;
              const newQuestionElem = document.querySelector('.question');
              if (newQuestionElem){
                newQuestionElem.classList.add('fade-in');
              }
              updateButtonStates(index); // 更新按钮状态
            }, 400); //与css动画时间一致
          } else {
            questionsContainer.innerHTML = questionHTML; // 直接显示
            updateButtonStates(index); // 更新按钮状态
          }


          // 更新内容区域
          const fileContentDiv = document.getElementById(question.file);
            if (fileContentDiv) {
              fileContentDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // 更新按钮状态 (提取为独立函数)
        function updateButtonStates(index) {
            prevButton.disabled = index === 0;
            hasAnswered = !!userAnswers[index];

            if (index === questions.length - 1) {
                nextButton.style.display = 'none';
                submitButton.style.display = 'inline-block';
                submitButton.disabled = !hasAnswered;
            } else {
                nextButton.style.display = 'inline-block';
                submitButton.style.display = 'none';
                nextButton.disabled = !hasAnswered;
            }
        }

        function checkAnswersAndProceed() {
            let correctCount = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correctAnswer) {
                    correctCount++;
                }
            }

            if (correctCount >= questions.length - 1) {
                document.cookie = "fdo_quiz_passed=true; path=/; max-age=" + (60 * 60 * 24 * 7);
                window.location.href = "/join";
            } else {
                alert(`很遗憾，您没有通过测试。答对 ${correctCount} 题，需要答对 ${questions.length - 1} 题及以上才能通过。请重新作答。`);
                resetQuiz();
            }
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            userAnswers = [];
            hasAnswered = false;
            displayQuestion(currentQuestionIndex);
            file3ContentDiv.innerHTML = file3Content;
        }

        prevButton.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex, true); // 切换时添加动画
            }
        });

        nextButton.addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1 && hasAnswered) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex, true); // 切换时添加动画
            }
        });

        submitButton.addEventListener('click', () => {
            if (hasAnswered) {
                checkAnswersAndProceed();
            }
        });

        questionsContainer.addEventListener('change', (event) => {
            if (event.target.type === 'radio') {
                const selectedAnswer = event.target.value;
                userAnswers[currentQuestionIndex] = selectedAnswer;
                hasAnswered = true;
                nextButton.disabled = false; // 启用“下一题”
                if(currentQuestionIndex === questions.length -1){
                  submitButton.disabled = false;
                }
            }
        });

        displayQuestion(currentQuestionIndex); // 初始加载，不带动画
    </script>
</body>
</html>
